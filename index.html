<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfect Drive | Location Premium</title>
    <link rel="icon" href="Perfect drive.jpeg" type="image/jpeg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        alpine: '#0051ff',
                        darkbg: '#070b13',
                    },
                    fontFamily: {
                        oswald: ['Oswald', 'sans-serif'],
                        montserrat: ['Montserrat', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        html { scroll-behavior: smooth; }
        body { background-color: #070b13; color: white; font-family: 'Montserrat', sans-serif; overflow-x: hidden; }
        
        .glass-panel {
            background: rgba(20, 20, 20, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transform: translateZ(0); 
        }
        
        .glass-input {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: white; transition: all 0.3s ease;
        }
        
        select { background-color: #0a0a0a !important; color: white !important; border: 1px solid rgba(255, 255, 255, 0.1); }
        input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }

        .alpine-btn { background: white; color: black; font-family: 'Oswald', sans-serif; text-transform: uppercase; letter-spacing: 2px; transition: all 0.3s ease; }
        .alpine-btn:hover { background: #0051ff; color: white; box-shadow: 0 0 30px rgba(0, 81, 255, 0.4); }
        .alpine-btn:disabled { cursor: not-allowed; opacity: 0.7; }

        .price-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; color: #aaa; }
        .price-table th { text-align: left; padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); color: #fff; font-family: 'Oswald'; font-weight: normal; letter-spacing: 1px; }
        .price-table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }

        .day-box { transition: all 0.2s ease; }
        .selected-limit { background-color: #0051ff !important; color: white !important; box-shadow: 0 0 15px rgba(0, 81, 255, 0.6); border: 1px solid #3b82f6; font-weight: bold; }
        .selected-range { background-color: rgba(0, 81, 255, 0.25) !important; color: #bfdbfe !important; border: 1px solid rgba(0, 81, 255, 0.3); }
        .past-date { opacity: 0.3; cursor: not-allowed !important; background: transparent !important; border: none !important; color: #666 !important; }
        .border-error { border-color: #ef4444 !important; background-color: rgba(239, 68, 68, 0.1) !important; }
    </style>
</head>
<body class="selection:bg-alpine selection:text-white">

    <header class="fixed w-full z-50 glass-panel border-b-0 top-0">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-20 h-auto flex items-center justify-center">
                    <img src="Perfect drive.jpeg" alt="Logo" class="w-full h-full object-contain mix-blend-screen filter brightness-125">
                </div>
                <div class="flex flex-col justify-center">
                    <h1 class="font-oswald text-2xl font-bold tracking-widest text-white uppercase leading-none mb-1">PERFECT DRIVE</h1>
                    <p class="font-montserrat text-[10px] font-bold text-alpine tracking-[0.3em] uppercase leading-none">LOCATION PREMIUM</p>
                </div>
            </div>
        </div>
    </header>

    <div id="showroom" class="relative pt-32 pb-10 px-6 overflow-hidden">
        <div class="absolute top-0 right-0 w-2/3 h-full bg-gradient-to-l from-blue-900/20 to-transparent pointer-events-none"></div>
        <div class="max-w-7xl mx-auto grid lg:grid-cols-2 gap-12 items-center">
            <div class="z-10">
                <div class="inline-block px-3 py-1 border border-blue-500/30 bg-blue-500/10 rounded mb-6">
                    <span class="text-blue-400 text-xs font-bold tracking-widest font-oswald">FLOTTE 2026</span>
                </div>
                <h2 class="font-oswald text-5xl md:text-7xl font-bold uppercase leading-[0.9] mb-6 text-white">Clio V <br/><span class="text-alpine">Esprit Alpine</span></h2>
                <p class="font-montserrat text-gray-400 text-lg max-w-md leading-relaxed mb-8 border-l-2 border-alpine pl-4">Finition Black Edition. Hybride E-Tech 145ch. <br>L'élégance radicale.</p>
                
                <div class="glass-panel p-6 rounded-xl max-w-sm">
                    <table class="price-table">
                        <thead><tr><th>DURÉE</th><th>STANDARD</th><th>ILLIMITÉ</th></tr></thead>
                        <tbody>
                            <tr><td>1 JOUR</td><td>60€</td><td>90€</td></tr>
                            <tr><td>2 JOURS</td><td>110€</td><td>170€</td></tr>
                            <tr><td>3 JOURS</td><td>150€</td><td>240€</td></tr>
                            <tr><td>SEMAINE</td><td>320€</td><td>520€</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="relative rounded-xl overflow-hidden shadow-2xl border border-white/10 aspect-[16/10]">
                <img src="voiture1.jpeg" class="w-full h-full object-cover" id="mainImage">
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent"></div>
            </div>
        </div>
    </div>

    <div id="booking" class="max-w-7xl mx-auto px-6 pb-20">
        <div class="grid lg:grid-cols-12 gap-8">
            <div class="lg:col-span-7">
                <div class="glass-panel p-6 md:p-8 rounded-2xl">
                    <div class="flex justify-between items-center mb-8">
                        <h3 class="font-oswald text-xl text-alpine tracking-[0.2em] uppercase">Disponibilités</h3>
                        <div class="flex gap-2">
                            <button onclick="changeMonth(-1)" class="p-2 bg-white/5 rounded-lg"><i data-lucide="chevron-left"></i></button>
                            <span id="currentMonthDisplay" class="font-oswald text-lg capitalize px-4">...</span>
                            <button onclick="changeMonth(1)" class="p-2 bg-white/5 rounded-lg"><i data-lucide="chevron-right"></i></button>
                        </div>
                    </div>
                    <div id="calendarGrid" class="grid grid-cols-7 gap-2"></div>
                </div>
            </div>

            <div class="lg:col-span-5 space-y-6">
                <div class="glass-panel p-6 rounded-2xl">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <input type="time" id="timeStart" class="w-full p-3 glass-input rounded-lg text-white" value="09:00">
                        <input type="time" id="timeEnd" class="w-full p-3 glass-input rounded-lg text-white" value="09:00">
                    </div>
                    <select id="mileageSelect" class="w-full p-4 glass-input rounded-lg mb-4" onchange="calculatePrice()">
                        <option value="standard">Standard (150km/j)</option>
                        <option value="unlimited">Kilométrage Illimité</option>
                    </select>
                    <div class="bg-blue-500/10 p-6 rounded-xl text-center border border-blue-500/20">
                        <div class="font-oswald text-4xl font-bold" id="displayPrice">60€</div>
                    </div>
                </div>

                <form onsubmit="handleBooking(event)" class="glass-panel p-6 rounded-2xl space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="firstname" placeholder="PRÉNOM" required class="glass-input p-4 rounded-lg">
                        <input type="text" id="lastname" placeholder="NOM" required class="glass-input p-4 rounded-lg">
                    </div>
                    <input type="tel" id="phone" placeholder="TÉLÉPHONE" required class="glass-input w-full p-4 rounded-lg">
                    
                    <div class="grid grid-cols-3 gap-2">
                        <label id="labelIdCard" class="glass-input p-2 rounded-lg text-[9px] text-center cursor-pointer border-dashed border-2">
                            <input type="file" id="fileIdCard" class="hidden" onchange="updateFileBox('fileIdCard', 'labelIdCard')">IDENTITÉ
                        </label>
                        <label id="labelLicense" class="glass-input p-2 rounded-lg text-[9px] text-center cursor-pointer border-dashed border-2">
                            <input type="file" id="fileLicense" class="hidden" onchange="updateFileBox('fileLicense', 'labelLicense')">PERMIS
                        </label>
                        <label id="labelProof" class="glass-input p-2 rounded-lg text-[9px] text-center cursor-pointer border-dashed border-2">
                            <input type="file" id="fileProof" class="hidden" onchange="updateFileBox('fileProof', 'labelProof')">DOMICILE
                        </label>
                    </div>

                    <button type="submit" id="submitBtn" class="w-full py-4 alpine-btn font-bold rounded">CONFIRMER MA DEMANDE</button>
                </form>

                <div id="adminZone" class="glass-panel p-6 rounded-2xl">
                    <h4 class="font-oswald text-sm text-gray-500 uppercase mb-4 tracking-widest">Demandes Récentes</h4>
                    <div id="requestsList" class="space-y-2"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentViewDate = new Date();
        let selectedStart = null, selectedEnd = null;
        const monthNames = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];

        function init() { renderCalendar(); lucide.createIcons(); }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
            document.getElementById('currentMonthDisplay').textContent = `${monthNames[currentViewDate.getMonth()]} ${currentViewDate.getFullYear()}`;
            const year = currentViewDate.getFullYear(), month = currentViewDate.getMonth();
            const firstDay = new Date(year, month, 1).getDay(), padding = firstDay === 0 ? 6 : firstDay - 1;
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date(); today.setHours(0,0,0,0);

            for(let i=0; i<padding; i++) grid.appendChild(document.createElement('div'));
            for(let i=1; i<=daysInMonth; i++) {
                const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                const cellDate = new Date(year, month, i);
                const d = document.createElement('div');
                d.textContent = i;
                d.className = "day-box aspect-square flex items-center justify-center rounded-lg border border-white/5 cursor-pointer text-sm";
                
                if (cellDate < today) d.classList.add('past-date');
                else {
                    if (dateStr === selectedStart || dateStr === selectedEnd) d.classList.add('selected-limit');
                    else if (selectedStart && selectedEnd && dateStr > selectedStart && dateStr < selectedEnd) d.classList.add('selected-range');
                    d.onclick = () => {
                        if (!selectedStart || (selectedStart && selectedEnd)) { selectedStart = dateStr; selectedEnd = null; }
                        else { if (dateStr < selectedStart) { selectedEnd = selectedStart; selectedStart = dateStr; } else { selectedEnd = dateStr; } }
                        renderCalendar(); calculatePrice();
                    };
                }
                grid.appendChild(d);
            }
        }

        function calculatePrice() {
            if(!selectedStart || !selectedEnd) return;
            const days = Math.ceil(Math.abs(new Date(selectedEnd) - new Date(selectedStart)) / (1000 * 60 * 60 * 24)) || 1;
            const unlimited = document.getElementById('mileageSelect').value === 'unlimited';
            const total = unlimited ? days * 90 : days * 60;
            document.getElementById('displayPrice').innerText = total + "€";
        }

        function changeMonth(d) { currentViewDate.setMonth(currentViewDate.getMonth() + d); renderCalendar(); }
        function updateFileBox(id, lbl) { if(document.getElementById(id).files[0]) document.getElementById(lbl).classList.add('border-green-500', 'bg-green-500/10'); }

        // --- FONCTION ENVOI MAKE.COM VERSION FINALE ---
        async function handleBooking(e) {
            e.preventDefault(); 
            
            // 1. Validation Dates
            if(!selectedStart || !selectedEnd) {
                alert("⚠️ Veuillez sélectionner vos dates de location sur le calendrier.");
                return;
            }

            // 2. Validation Documents
            const idCard = document.getElementById('fileIdCard').files[0];
            const license = document.getElementById('fileLicense').files[0];
            const proof = document.getElementById('fileProof').files[0];
            
            if(!idCard || !license || !proof) {
                alert("⛔ Documents manquants !\nMerci de joindre votre pièce d'identité, permis et justificatif de domicile.");
                return;
            }

            const btn = document.getElementById('submitBtn');
            const originalText = btn.textContent;
            
            // 3. État de chargement (Feedback visuel)
            btn.disabled = true;
            btn.textContent = "TRAITEMENT EN COURS...";
            btn.style.backgroundColor = "#0051ff"; // Bleu Alpine
            btn.style.opacity = "0.8";

            // 4. Préparation du formulaire
            const formData = new FormData();
            formData.append('prenom', document.getElementById('firstname').value);
            formData.append('nom', document.getElementById('lastname').value);
            formData.append('tel', document.getElementById('phone').value);
            formData.append('prix', document.getElementById('displayPrice').innerText);
            formData.append('option', document.getElementById('mileageSelect').value);
            formData.append('debut', selectedStart + " à " + (document.getElementById('timeStart').value || "09:00"));
            formData.append('fin', selectedEnd + " à " + (document.getElementById('timeEnd').value || "09:00"));
            
            // Ajout des fichiers
            formData.append('photo_id', idCard);
            formData.append('photo_permis', license);
            formData.append('photo_justif', proof);

            try {
                // 5. Envoi vers Make.com
                const response = await fetch('https://hook.eu1.make.com/7xza5kjfbpl6eq78r0ldvja52bwk8816', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    // 6. Succès
                    btn.style.backgroundColor = "#22c55e"; // Vert
                    btn.style.opacity = "1";
                    btn.textContent = "DEMANDE ENREGISTRÉE";
                    
                    alert("✅ Votre demande a bien été transmise.\n\nNotre équipe va vérifier la disponibilité et vos documents. Vous recevrez une confirmation définitive par téléphone ou SMS dans les plus brefs délais.\n\nMerci de votre confiance.");
                    
                    // Reset
                    e.target.reset();
                    selectedStart = null; selectedEnd = null;
                    renderCalendar();
                    calculatePrice();
                    
                    // Remise à zéro des bordures fichiers
                    ['labelIdCard', 'labelLicense', 'labelProof'].forEach(id => {
                        document.getElementById(id).classList.remove('border-green-500', 'bg-green-500/10');
                    });

                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.backgroundColor = "white";
                        btn.style.color = "black";
                        btn.disabled = false;
                    }, 5000);

                } else {
                    throw new Error();
                }
            } catch (error) {
                console.error(error);
                alert("❌ Une erreur technique est survenue. Merci de réessayer ou de nous contacter directement.");
                btn.disabled = false;
                btn.textContent = originalText;
                btn.style.backgroundColor = "white";
            }
        }

        window.onload = init;
    </script>
</body>
</html>
